// javascript:(function(){function e(){function decodeHTMLEntities(text){if(!text)return'';const textArea=document.createElement('textarea');textArea.innerHTML=text;return textArea.value;}const d=new Date().toLocaleString();let t="",p="",r="",x="",n="",a="",c="",mf={},gf={},publicado="",visualizaciones=0;const pubElement=document.querySelector('#user-views p:first-child, .view-users-container p:first-child');if(pubElement){const pubText=pubElement.textContent.trim();const pubMatch=pubText.match(/Publicado\s+(.*)/i);if(pubMatch&&pubMatch[1]){publicado=pubMatch[1].trim()}else{publicado=pubText}}const viewsElement=document.querySelector('#user-views .tooltip-module__tooltipButton___3CqEF p, .view-users-container .tooltip-module__tooltipButton___3CqEF p');if(viewsElement){const viewsText=viewsElement.textContent.trim();const viewsMatch=viewsText.match(/(\d+)/);if(viewsMatch&&viewsMatch[1]){visualizaciones=parseInt(viewsMatch[1],10)}}const mt=document.querySelector('meta[property="og:title"]')||document.querySelector('meta[name="title"]');if(mt)t=decodeHTMLEntities(mt.getAttribute('content'));else{const h1=document.querySelector('h1');if(h1)t=decodeHTMLEntities(h1.textContent.trim());else t=decodeHTMLEntities(document.title)}const el=document.querySelector('.title-type-sup-property, h2.title-type');if(el){const tx=el.textContent.trim();const m=tx.match(/^([^·]+)/);if(m&&m[1])p=decodeHTMLEntities(m[1].trim())}const ad=document.querySelector('.section-location-property h4');if(ad)a=decodeHTMLEntities(ad.textContent.trim());const pe=document.querySelector('.price-value span span')||document.querySelector('.price-items span')||document.querySelector('.price-items h2')||document.querySelector('.price-value span');if(pe)r=decodeHTMLEntities(pe.textContent.trim());const ee=document.querySelector('.price-expenses');if(ee){const tx=ee.textContent.trim();const m=tx.match(/Expensas(.+)/);if(m&&m[1])x=decodeHTMLEntities(m[1].trim());else x=decodeHTMLEntities(tx.replace(/^Expensas\s*/i,'').trim())}try{const h=document.documentElement.innerHTML;const mp=h.match(/const\s+publisher\s*=\s*({.+?})[;\s]/s)||h.match(/publisher\s*[:=]\s*({.+?})[,;\s]/s);if(mp&&mp[1]){try{const dp=JSON.parse(mp[1]);n=decodeHTMLEntities(dp.name||"")}catch(e){}}const im=document.querySelector('.static-map, #static-map');if(im){const src=im.getAttribute('src');const mc=src.match(/center=([-\d.]+),([-\d.]+)/);if(mc&&mc.length>=3)c=mc[1]+","+mc[2]}const mm=h.match(/'mainFeatures':\s*({.+?}),\s*'[a-zA-Z]/s);if(mm&&mm[1]){try{mf=JSON.parse(mm[1])}catch(e){}}const mg=h.match(/'generalFeatures':\s*({.+?}),\s*'[a-zA-Z]/s);if(mg&&mg[1]){try{gf=JSON.parse(mg[1])}catch(e){}}}catch(e){}const u=window.location.href;let pd={"url":u,"fecha ejecución":d,"título":t,"tipo":p,"precio":r,"expensas":x,"publicador":n,"dirección":a,"coordenadas":c,"publicado":publicado,"visualizaciones":visualizaciones};function processMainFeatures(){if(mf&&typeof mf==='object'){Object.values(mf).forEach(f=>{if(f&&f.label){let cn=f.label.toLowerCase();if(f.measure){cn=`${cn} ${f.measure}`}cn=cn.endsWith('s')?cn.slice(0,-1):cn;pd[cn]=decodeHTMLEntities(f.value||"Sí")}});}}function formatGeneralFeatures(json){if(json&&typeof json==='object'){Object.keys(json).forEach(category=>{let values=[];if(json[category]&&typeof json[category]==='object'){Object.values(json[category]).forEach(feature=>{if(feature&&feature.label){if(feature.value!==null&&feature.value!==undefined&&feature.value!=="")values.push(`${decodeHTMLEntities(feature.label)} : ${decodeHTMLEntities(feature.value)}`);else values.push(decodeHTMLEntities(feature.label))}});let catName=category.toLowerCase();catName=catName.endsWith('s')?catName.slice(0,-1):catName;pd[catName]=values.join(' • ')}});}}function extractGeneralFeaturesDOM(){try{const featuresContainer=document.querySelector('#reactGeneralFeatures');if(!featuresContainer)return;const allButtons=featuresContainer.querySelectorAll('button.sc-fBdRDi');allButtons.forEach((button,index)=>{const categoryName=button.querySelector('span').textContent.trim();let values=[];const clickEvent=new MouseEvent('click',{bubbles:true,cancelable:true,view:window});button.dispatchEvent(clickEvent);setTimeout(()=>{const items=featuresContainer.querySelectorAll('.sc-kYxDKI span.sc-bpUBKd');items.forEach(item=>{const text=item.textContent.trim();if(text)values.push(decodeHTMLEntities(text))});let catName=categoryName.toLowerCase();catName=catName.endsWith('s')?catName.slice(0,-1):catName;pd[catName]=values.join(' • ')},100);});}catch(e){console.error("Error extrayendo datos del DOM:",e)}}processMainFeatures();formatGeneralFeatures(gf);extractGeneralFeaturesDOM();return pd}function g(d){const h=Object.keys(d);const lh=h.join(',');const lv=h.map(k=>{let v=typeof d[k]==='string'?d[k]:String(d[k]);return'"'+v.replace(/"/g,'""')+'"'}).join(',');const B=new Uint8Array([0xEF,0xBB,0xBF]);const c=lh+'\n'+lv;const te=new TextEncoder();const cc=te.encode(c);const cb=new Uint8Array(B.length+cc.length);cb.set(B);cb.set(cc,B.length);return cb}function d(c,t){let n=t&&t!==""?t.replace(/[\\/:*?"<>|]/g,"_").substring(0,50):new Date().toLocaleString().replace(/[\\/:*?"<>|]/g,"_");n+=".csv";const b=new Blob([c],{type:'text/csv;charset=utf-8'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.setAttribute('href',u);a.setAttribute('download',n);a.style.display='none';document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(u)}try{const da=e();const c=g(da);d(c,da.título);return false}catch(e){console.error("Error:",e);alert("Error al exportar datos: "+e.message);return false}})();void(0);